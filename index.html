<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wedding Seating Chart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500&display=swap');
        
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-sans { font-family: 'Inter', sans-serif; }
        
        body {
            background: #f8f9fa;
        }
        
        .premium-card {
            background: #ffffff;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.08),
                0 10px 20px rgba(0, 0, 0, 0.04);
            border: 1px solid #e5e7eb;
        }
        
        .classic-input {
            background: #ffffff;
            border: 1px solid #d1d5db;
            transition: all 0.2s ease;
        }
        
        .classic-input:focus {
            border-color: #374151;
            box-shadow: 0 0 0 3px rgba(55, 65, 81, 0.1);
        }
        
        .classic-button {
            background: #111827;
            transition: all 0.2s ease;
        }
        
        .classic-button:hover {
            background: #000000;
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .classic-line {
            background: #d1d5db;
            height: 1px;
        }
        
        .classic-suggestions {
            background: #ffffff;
            border: 1px solid #d1d5db;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4 flex items-center justify-center" style="max-width: 375px; margin: 0 auto;">
  <div class="premium-card rounded-lg p-4 w-full">
    <div class="text-center mb-6 mt-8">
      <h1 class="font-serif text-2xl text-gray-800 font-bold">Find your Seat</h1>
    </div>

    <div class="space-y-3">
      <div class="relative">
        <input
          type="text"
          id="guestName"
          placeholder="Enter your name"
          class="classic-input w-full px-3 py-2 text-sm rounded focus:outline-none font-sans text-gray-800 placeholder-gray-400"
          oninput="handleInput()"
          onfocus="handleFocus()"
          onblur="hideSuggestions()"
        />
        <div
          id="suggestions"
          class="classic-suggestions absolute top-full left-0 right-0 rounded mt-1 max-h-32 overflow-y-auto z-10 hidden"
        ></div>
      </div>

      <button
        onclick="findTable()"
        class="classic-button w-full text-white font-medium py-2 px-4 rounded font-sans text-sm"
      >
        Find Table
      </button>

      <div
        id="result"
        class="text-center font-sans text-gray-700 min-h-[20px] text-sm"
      ></div>
    </div>

    <!-- Footer Buttons -->
    <div class="mt-12 text-center space-x-4">
      <button
        onclick="showHelp()"
        class="text-gray-500 hover:text-gray-700 font-sans text-xs underline"
      >
        Help
      </button>
      <button
        onclick="showGuestList()"
        class="text-gray-500 hover:text-gray-700 font-sans text-xs underline"
      >
        Total Guests
      </button>
      <button
        onclick="showContact()"
        class="text-gray-500 hover:text-gray-700 font-sans text-xs underline"
      >
        Want One?
      </button>
    </div>
  </div>

  <script>
    let guestList = {};
    const guestListUrl =
      'https://docs.google.com/spreadsheets/d/1uJVXE5P07e2vILzqzGFmUHBpquY6gyNXt71Qlb5PIOQ/export?format=csv';

    function loadGuestData() {
      loadFromUrl(guestListUrl);
    }

    function loadFromUrl(url) {
      fetch(url)
        .then((response) => {
          if (!response.ok) throw new Error("Network error");
          return response.text();
        })
        .then((csvData) => {
          parseCSVData(csvData);
          localStorage.setItem(
            "weddingGuestList",
            JSON.stringify(guestList)
          );
          updateGuestCounter();
        })
        .catch((error) => {
          const savedData = localStorage.getItem("weddingGuestList");
          if (savedData) {
            try {
              guestList = JSON.parse(savedData);
              updateGuestCounter();
            } catch (e) {
              console.error("Error parsing backup data:", e);
            }
          }
        });
    }

    // âœ… UPDATED FUNCTION: Ignore header row and use Column A & B starting from row 2
    function parseCSVData(csvData) {
      const lines = csvData.split("\n");
      const newGuestList = {};

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line) {
          const parts = line.split(",");
          if (parts.length >= 2) {
            const name = parts[0].trim().replace(/"/g, "");
            const table = parts[1].trim().replace(/"/g, "");
            if (name && table) {
              newGuestList[name] = table;
            }
          }
        }
      }

      guestList = newGuestList;
    }

    function updateGuestCounter() {
      const counter = document.getElementById("guestCounter");
      if (counter) {
        counter.textContent = Object.keys(guestList).length;
      }
    }

    loadGuestData();
    setInterval(() => {
      if (guestListUrl) {
        loadFromUrl(guestListUrl);
      }
    }, 30000);

    function showHelp() {
      document.body.innerHTML += `
        <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="closeHelp()">
            <div class="bg-white rounded-lg p-4 m-4 w-80 h-96 shadow-2xl flex flex-col items-center justify-center" onclick="event.stopPropagation()">
                <div class="text-center mb-8">
                    <h3 class="font-serif text-lg text-gray-800 font-semibold">How to Use</h3>
                </div>
                <div class="space-y-6 mb-8">
                    <div class="space-y-2 font-sans text-sm text-gray-700 px-2">
                        <div class="flex items-center space-x-3"><div class="bg-gray-800 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">1</div><div>Type your name</div></div>
                        <div class="flex items-center space-x-3"><div class="bg-gray-800 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">2</div><div>Select from suggestions</div></div>
                        <div class="flex items-center space-x-3"><div class="bg-gray-800 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">3</div><div>Click "Find Table"</div></div>
                        <div class="flex items-center space-x-3"><div class="bg-gray-800 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold">!</div><div>Names are not case-sensitive</div></div>
                    </div>
                </div>
                <div class="text-center">
                    <button onclick="closeHelp()" class="bg-gray-800 hover:bg-black text-white font-medium py-2 px-4 rounded font-sans text-sm">Got it!</button>
                </div>
            </div>
        </div>`;
    }

    function closeHelp() {
      const modal = document.getElementById("helpModal");
      if (modal) modal.remove();
    }

    function showGuestList() {
      const guestCount = Object.keys(guestList).length;
      document.body.innerHTML += `
        <div id="guestListModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="closeGuestList()">
            <div class="bg-white rounded-lg p-4 m-4 w-80 h-96 shadow-2xl flex flex-col items-center justify-center" onclick="event.stopPropagation()">
                <div class="text-center mb-8"><h3 class="font-serif text-lg text-gray-800 font-semibold">Total Guests</h3></div>
                <div class="space-y-6 mb-8">
                    <div class="text-center px-2">
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-2xl font-sans font-bold text-gray-800 mb-1">${guestCount}</div>
                            <div class="font-sans text-sm text-gray-600">Total Guests</div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button onclick="closeGuestList()" class="bg-gray-800 hover:bg-black text-white font-medium py-2 px-4 rounded font-sans text-sm">Close</button>
                </div>
            </div>
        </div>`;
    }

    function closeGuestList() {
      const modal = document.getElementById("guestListModal");
      if (modal) modal.remove();
    }

    function showContact() {
      document.body.innerHTML += `
        <div id="contactModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onclick="closeContact()">
            <div class="bg-white rounded-lg p-4 m-4 w-80 h-96 shadow-2xl flex flex-col items-center justify-center" onclick="event.stopPropagation()">
                <div class="text-center mb-8">
                    <h3 class="font-mono text-lg text-gray-800 font-bold">JUSWANDERCRAFT</h3>
                    <p class="font-sans text-xs text-gray-600">Digital Wedding Solutions</p>
                </div>
                <div class="space-y-4 mb-8">
                    <div class="text-center">
                        <p class="font-sans text-xs text-gray-700">Want a custom seating chart<br>for your special event?</p>
                    </div>
                    <div class="space-y-1 px-2">
                        <a href="https://instagram.com/juswandercraft" target="_blank" class="flex items-center justify-center p-2 bg-gray-50 hover:bg-gray-100 rounded-lg">
                            <span class="font-sans text-xs text-gray-700">INSTAGRAM: @juswandercraft</span>
                        </a>
                        <a href="mailto:juswandercraft@gmail.com" class="flex items-center justify-center p-2 bg-gray-50 hover:bg-gray-100 rounded-lg">
                            <span class="font-sans text-xs text-gray-700">EMAIL: juswandercraft@gmail.com</span>
                        </a>
                    </div>
                </div>
                <div class="text-center">
                    <button onclick="closeContact()" class="bg-gray-800 hover:bg-black text-white font-medium py-2 px-4 rounded font-sans text-sm">Close</button>
                </div>
            </div>
        </div>`;
    }

    function closeContact() {
      const modal = document.getElementById("contactModal");
      if (modal) modal.remove();
    }

    let shouldClearOnFocus = false;

    function handleInput() {
      showSuggestions();
    }

    function handleFocus() {
      const nameInput = document.getElementById("guestName");
      const resultDiv = document.getElementById("result");
      if (shouldClearOnFocus || resultDiv.innerHTML.trim() !== "") {
        nameInput.value = "";
        resultDiv.innerHTML = "";
        shouldClearOnFocus = false;
      }
      showSuggestions();
    }

    function showSuggestions() {
      const nameInput = document.getElementById("guestName");
      const suggestionsDiv = document.getElementById("suggestions");
      const resultDiv = document.getElementById("result");
      const inputValue = nameInput.value.trim().toLowerCase();
      resultDiv.innerHTML = "";
      if (!inputValue) {
        suggestionsDiv.classList.add("hidden");
        return;
      }

      const matchingNames = Object.keys(guestList).filter((name) => {
        const nameLower = name.toLowerCase();
        const words = nameLower.split(" ");
        return (
          nameLower.startsWith(inputValue) ||
          words.some((word) => word.startsWith(inputValue))
        );
      });

      if (matchingNames.length === 0) {
        suggestionsDiv.classList.add("hidden");
        return;
      }

      suggestionsDiv.innerHTML = matchingNames
        .map(
          (name) =>
            `<div class="px-3 py-2 hover:bg-gray-50 cursor-pointer font-sans text-gray-800 text-sm border-b border-gray-100 last:border-b-0" onmousedown="selectName('${name}')">${name}</div>`
        )
        .join("");
      suggestionsDiv.classList.remove("hidden");
    }

    function hideSuggestions() {
      setTimeout(() => {
        document.getElementById("suggestions").classList.add("hidden");
      }, 150);
    }

    function selectName(name) {
      document.getElementById("guestName").value = name;
      document.getElementById("suggestions").classList.add("hidden");
    }

    function findTable() {
      const nameInput = document.getElementById("guestName");
      const resultDiv = document.getElementById("result");
      const guestName = nameInput.value.trim();
      if (!guestName) {
        resultDiv.innerHTML =
          '<p class="text-stone-500">Please enter your name</p>';
        return;
      }

      let tableNumber = guestList[guestName];
      if (!tableNumber) {
        const lowerCaseName = guestName.toLowerCase();
        for (const [name, table] of Object.entries(guestList)) {
          if (name.toLowerCase() === lowerCaseName) {
            tableNumber = table;
            break;
          }
        }
      }

      if (tableNumber) {
        resultDiv.innerHTML = `<p class="text-gray-700 font-sans">You are seated at <span class="font-bold">Table ${tableNumber}</span></p>`;
        shouldClearOnFocus = true;
      } else {
        resultDiv.innerHTML =
          '<p class="text-gray-700 font-sans">Name not found. Please check your spelling.</p>';
        shouldClearOnFocus = true;
      }
    }

    document
      .getElementById("guestName")
      .addEventListener("keypress", function (e) {
        if (e.key === "Enter") findTable();
      });
  </script>
</body>
</html>
